<div class="container">
  
  <!-- Mostra un messaggio di caricamento o di errore del token -->
  @if (isLoading || invalidToken) {
    <div class="state-container">
      @if (isLoading) {
        <p>Verifica del token in corso...</p>
      }
      @if (invalidToken) {
        <div class="icon-error">!</div>
        <p class="error-message">
          Il link per il reset della password non è valido o è scaduto.
        </p>
        <a routerLink="/forgot-password" class="back-link">Richiedi un nuovo link</a>
      }
    </div>
  }

  <!-- Mostra il form solo se il token è valido e il caricamento è finito -->
  @if (!isLoading && !invalidToken) {
    <div class="form-wrapper">
      <h2>Crea una nuova password</h2>
      <p class="subtitle">Inserisci una nuova password sicura per il tuo account.</p>
      
      <form #resetForm="ngForm" (ngSubmit)="doResetPassword()">
        <!-- Nuova Password -->
        <div class="form-group">
          <label for="password">Nuova Password</label>
          <input 
            id="password"
            name="password"
            type="password"
            placeholder="Almeno 6 caratteri"
            [(ngModel)]="password"
            required
            minlength="6"
          />
        </div>
        
        <!-- Conferma Password -->
        <div class="form-group">
          <label for="password2">Conferma Nuova Password</label>
          <input 
            id="password2"
            name="password2"
            type="password"
            placeholder="Ripeti la password"
            [(ngModel)]="password2"
            required
          />
        </div>
        
        <button type="submit" class="btn-submit" [disabled]="isSaving || resetForm.invalid || (password !== password2)">
          {{ isSaving ? 'Salvataggio in corso...' : 'Salva Nuova Password' }}
        </button>
      </form>
    </div>
  }

</div>